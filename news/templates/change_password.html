{% load static %}
{% block body %}

<!doctype html>
<html lang="en">
<head>
  <script>
setTimeout(() => location.reload(true), 30000);
</script>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="Cache-Control" content="no-cache">

  <title>News Portal – Change Password</title>
 <link rel="icon" type="image/png" href="{% static 'images/logo2.png' %}">
  <!-- Bootstrap 5 + FA 6 + SweetAlert2 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet"/>
  <script defer src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root{
      --ink:#0f172a; --muted:#64748b; --primary:#0ea5e9; --primary-2:#0369a1;
    }
    body{ background:#f8fafc; color:var(--ink); }
    .with-sidebar{ margin-left:260px; transition:margin-left .2s ease; }
    body.sidebar-collapsed .with-sidebar{ margin-left:76px; }

    .card-glass{
      border:0; border-radius:1rem; background:#fff;
      box-shadow:0 12px 34px rgba(15,23,42,.12);
    }
    .form-floating>label{ color:var(--muted); }
    .input-group .toggle-pass{
      border-top-right-radius:.5rem; border-bottom-right-radius:.5rem;
    }
  </style>
</head>
<body>

  {% include 'sidebar.html' %}
  {% include 'admin_nav.html' %}

  <main id="main-container" class="with-sidebar">
    <div class="container-fluid py-4 py-lg-5">

      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
        <h1 class="h4 mb-0" style="color:var(--primary-2)">
          <i class="fa-solid fa-key me-2"></i> Change Password
        </h1>
        <a href="{% url 'admin_home' %}" class="btn btn-sm btn-outline-primary">
          <i class="fa-solid fa-gauge-high me-1"></i> Dashboard
        </a>
      </div>

      <div class="row g-4">
        <div class="col-lg-6">
          <div class="card card-glass">
            <div class="card-body p-4 p-md-5">
              <h2 class="h5 mb-3">Update your password</h2>
              <p class="text-muted mb-4">Use a strong password you don’t use elsewhere.</p>

              <form method="post" id="changePassForm" novalidate>
                {% csrf_token %}

                <div class="mb-3 form-floating">
                  <input type="password" class="form-control" id="currentpassword" name="currentpassword" placeholder="Current Password" required>
                  <label for="currentpassword"><i class="fa-solid fa-lock me-1"></i> Current Password</label>
                </div>

                <div class="mb-3">
                  <div class="input-group">
                    <div class="form-floating flex-grow-1">
                      <input type="password" class="form-control" id="newpassword" name="newpassword" placeholder="New Password" required minlength="6">
                      <label for="newpassword"><i class="fa-solid fa-shield-halved me-1"></i> New Password</label>
                    </div>
                    <button class="btn btn-outline-secondary toggle-pass" type="button" data-target="#newpassword" aria-label="Show/Hide">
                      <i class="fa-regular fa-eye"></i>
                    </button>
                  </div>
                  <div class="form-text">Minimum 6 characters recommended.</div>
                </div>

                <div class="mb-4">
                  <div class="input-group">
                    <div class="form-floating flex-grow-1">
                      <input type="password" class="form-control" id="confirmpassword" name="confirmpassword" placeholder="Confirm Password" required>
                      <label for="confirmpassword"><i class="fa-regular fa-circle-check me-1"></i> Confirm Password</label>
                    </div>
                    <button class="btn btn-outline-secondary toggle-pass" type="button" data-target="#confirmpassword" aria-label="Show/Hide">
                      <i class="fa-regular fa-eye"></i>
                    </button>
                  </div>
                </div>

                <div class="d-grid">
                  <button type="submit" class="btn btn-primary">
                    <i class="fa-solid fa-key me-1"></i> Change Password
                  </button>
                </div>
              </form>

            </div>
          </div>
        </div>

        <div class="col-lg-6">
          <div class="card card-glass">
            <div class="card-body p-4 p-md-5">
              <h2 class="h6 mb-3"><i class="fa-solid fa-lightbulb me-2"></i> Tips</h2>
              <ul class="mb-0 text-muted">
                <li>Use a combination of letters, numbers and symbols.</li>
                <li>Avoid using personal info (name, phone, DOB).</li>
                <li>Don’t reuse passwords from other sites.</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

    </div>

    {% include 'adminfooter.html' %}
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // toggle password visibility
    document.querySelectorAll('.toggle-pass').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const target = document.querySelector(btn.dataset.target);
        if(!target) return;
        target.type = target.type === 'password' ? 'text' : 'password';
        const icon = btn.querySelector('i');
        if(icon){ icon.classList.toggle('fa-eye'); icon.classList.toggle('fa-eye-slash'); }
      });
    });

    // client-side match check with SweetAlert
    document.getElementById('changePassForm').addEventListener('submit', function(e){
      const np = document.getElementById('newpassword').value;
      const cp = document.getElementById('confirmpassword').value;
      if(np !== cp){
        e.preventDefault();
        Swal.fire({
          icon: 'error',
          title: 'Passwords do not match',
          text: 'New Password and Confirm Password must be the same.',
          confirmButtonText: 'Okay'
        });
      }
    });

    // server flags → SweetAlert
    {% if error == "yes" %}
      Swal.fire({
        icon: 'success',
        title: 'Password changed',
        text: 'Please sign in again.',
        timer: 1400,
        showConfirmButton: false
      }).then(()=>{ window.location = "{% url 'logout' %}"; });
    {% elif error == "not" %}
      Swal.fire({
        icon: 'error',
        title: 'Passwords do not match',
        text: 'New Password and Confirm Password are not match'
      });
    {% endif %}
  </script>
</body>
</html>

{% endblock %}
