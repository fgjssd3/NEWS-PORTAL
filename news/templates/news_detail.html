{% load static %}
{% block body %}

<!doctype html>
<html lang="en">
<head>
  <script>
setTimeout(() => location.reload(true), 30000);
</script>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
 <link rel="icon" type="image/png" href="{% static 'images/logo2.png' %}">
 <meta http-equiv="Cache-Control" content="no-cache">
  <title>News Portal | {{ newspost.posttitle }}</title>

  <!-- Bootstrap 5 + FA6 + SweetAlert2 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet"/>
  <script defer src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root{ --ink:#0f172a; --muted:#64748b; --primary:#0ea5e9; --primary-2:#0369a1; }
    body{ background:#f8fafc; color:var(--ink); }
    .article-card{ border:0; border-radius:1rem; box-shadow:0 12px 34px rgba(15,23,42,.12); }
    .meta{ color:var(--muted); }
    .meta a{ text-decoration:none; }
    .hero-img{ width:100%; border-radius: .75rem; }
    .comment-card{ border:0; border-radius:1rem; box-shadow:0 8px 24px rgba(15,23,42,.1); }
    .avatar{
      width:48px;height:48px;border-radius:50%;object-fit:cover;border:1px solid #e2e8f0;
    }
    .form-floating>label{ color:var(--muted); }
    .badge-cat{ background:#e0f2fe; color:#075985; border:1px solid #bae6fd; }
    .share a{ color:inherit; opacity:.85; }
    .share a:hover{ opacity:1; }
  </style>
</head>
<body>

  <!-- Header -->
  {% include 'header.html' %}

  <!-- Page Content -->
  <div class="container py-4 py-lg-5">

    <div class="row g-4">
      <!-- Main column -->
      <div class="col-lg-8">

        <!-- Article -->
        <div class="card article-card p-3 p-sm-4">
          <div class="card-body">
            <h1 class="h3">{{ newspost.posttitle }}</h1>

            <div class="d-flex flex-wrap align-items-center gap-2 meta mb-3">
              <span class="badge badge-cat">
                <i class="fa-solid fa-tag me-1"></i>
                <a href="{% url 'categorynews' newspost.category.id %}">{{ newspost.category.categoryname }}</a>
              </span>
              <span><i class="fa-regular fa-calendar-days me-1"></i> {{ newspost.postdate }}</span>
            </div>

            {% if newspost.postimage %}
              <img class="hero-img mb-3" src="{{ newspost.postimage.url }}" alt="{{ newspost.posttitle }}">
            {% endif %}

            <div class="mt-2">
              {{ newspost.postdetail|safe }}
            </div>

           <!-- Share (optional, simple links) -->
<div class="d-flex align-items-center gap-3 mt-4 share">
  <span class="meta">Partage:</span>
  
  <!-- Twitter -->
  <a href="https://twitter.com/intent/tweet?text={{ newspost.posttitle|urlencode }}%20{{ request.build_absolute_uri|urlencode }}" 
     target="_blank" rel="noopener nofollow" 
     class="text-dark" title="Partager sur Twitter">
    <i class="fa-brands fa-x-twitter"></i>
  </a>
  
  <!-- Facebook -->
  <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri|urlencode }}" 
     target="_blank" rel="noopener nofollow" 
     class="text-primary" title="Partager sur Facebook">
    <i class="fa-brands fa-facebook"></i>
  </a>
  
  <!-- WhatsApp -->
  <a href="whatsapp://send?text={{ newspost.posttitle|urlencode }}%20-%20{{ request.build_absolute_uri|urlencode }}" 
     target="_blank" rel="noopener nofollow" 
     class="text-success" title="Partager sur WhatsApp"
     data-action="share/whatsapp/share">
    <i class="fa-brands fa-whatsapp"></i>
  </a>
  
  <!-- Email -->
  <a href="mailto:?subject={{ newspost.posttitle|urlencode }}&body=DÃ©couvrez cet article:%0D%0A{{ newspost.posttitle|urlencode }}%0D%0A{{ request.build_absolute_uri|urlencode }}" 
     class="text-secondary" title="Partager par email">
    <i class="fa-solid fa-envelope"></i>
  </a>
  
  <!-- LinkedIn (optionnel) -->
  <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri|urlencode }}" 
     target="_blank" rel="noopener nofollow" 
     class="text-info" title="Partager sur LinkedIn">
    <i class="fa-brands fa-linkedin"></i>
  </a>
</div>

        <!-- Comments -->
        <div class="card comment-card mt-4">
          <div class="card-header bg-white">
            <h5 class="mb-0"><i class="fa-regular fa-comments me-2"></i> Laisser un commentaire</h5>
          </div>
          <div class="card-body">
            <form name="Comment" id="commentForm" method="post" novalidate>
              {% csrf_token %}
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="name" name="name" placeholder="Full name" required minlength="2">
                    <label for="name"><i class="fa-regular fa-user me-1"></i> Nom complet</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input type="email" class="form-control" id="emailid" name="emailid" placeholder="Email address" required>
                    <label for="emailid"><i class="fa-regular fa-envelope me-1"></i> Email</label>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-floating">
                    <textarea class="form-control" id="commentmsg" name="commentmsg" placeholder="Write your comment" style="height: 140px" required></textarea>
                    <label for="commentmsg"><i class="fa-regular fa-message me-1"></i> Commentaire</label>
                  </div>
                </div>
              </div>

              <div class="d-flex justify-content-end mt-3">
                <button type="submit" class="btn btn-primary" name="submit">
                  <i class="fa-regular fa-paper-plane me-1"></i> Soumettre
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Comments list -->
        {% if comment %}
          <div class="mt-4">
            {% for i in comment %}
              <div class="d-flex gap-3 py-3 border-bottom">
                <img class="avatar" src="{% static 'images/usericon.png' %}" alt="{{ i.name|default:'User' }}">
                <div>
                  <div class="d-flex align-items-center gap-2 flex-wrap">
                    <h6 class="mb-0">{{ i.name }}</h6>
                    <span class="small meta"><i class="fa-regular fa-clock me-1"></i>{{ i.cdate }}</span>
                  </div>
                  <div class="mt-1">
                    {{ i.commentmsg }}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}

      </div>

      <!-- Sidebar -->
      {% include 'sidebaruser.html' %}
    </div>
  </div>

  <!-- Footer -->
  {% include 'footer.html' %}

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // light client-side validation + double submit guard
    window.addEventListener('DOMContentLoaded', function(){
      const form = document.getElementById('commentForm');
      if(!form) return;

      form.addEventListener('submit', function(e){
        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('emailid').value.trim();
        const msg = document.getElementById('commentmsg').value.trim();

        if(name.length < 2){
          e.preventDefault();
          Swal.fire({icon:'error', title:'Enter your name', text:'Please provide at least 2 characters.'});
          return;
        }
        if(!email){
          e.preventDefault();
          Swal.fire({icon:'error', title:'Enter a valid email'});
          return;
        }
        if(msg.length < 3){
          e.preventDefault();
          Swal.fire({icon:'error', title:'Comment too short'});
          return;
        }

        // prevent double submit
        form.querySelector('button[type="submit"]')?.setAttribute('disabled','disabled');
      });

      // server feedback via `error` context variable
      {% if error == "no" %}
        Swal.fire({
          icon:'success',
          title:'Comment submitted',
          text:'Your comment will appear after admin review.',
          timer:1700, showConfirmButton:false, timerProgressBar:true
        });
      {% elif error == "yes" %}
        Swal.fire({ icon:'error', title:'Something went wrong', text:'Please try again.' });
      {% endif %}
    });
  </script>
</body>
</html>

{% endblock %}
